

  <%- include('../user/partials/header') %>
<%- include('../user/partials/head') %>
<head>
  <!-- Include Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.all.min.js"></script>
  <style>
    /* Custom styles can be added here */
    .active-tab {
      background-color: #f3e8ff;
      color: #7e22ce;
      border-left: 4px solid #7e22ce;
    }
  </style>
</head>
<body class="min-h-screen bg-gray-50">
  <!-- Header -->
  <header class="bg-purple-700 text-white p-6">
    <div class="container mx-auto">
      <div class="flex justify-between items-center">
        <h1 class="text-2xl font-bold">My Account</h1>
        <!-- <div class="flex items-center gap-4">
          <a href="/" class="inline-flex items-center px-4 py-2 bg-purple-800 hover:bg-purple-900 text-white rounded-md">
            <i data-lucide="home" class="h-4 w-4 mr-2"></i>
            Home
          </a>
          <a href="/logout" class="inline-flex items-center px-4 py-2 bg-purple-800 hover:bg-purple-900 text-white rounded-md">
            <i data-lucide="log-out" class="h-4 w-4 mr-2"></i>
            Sign Out
          </a>
        </div> -->
      </div>
    </div>
  </header>

  <main class="container mx-auto py-8 px-4">
    <div class="flex justify-center">
      <!-- Main Content Area -->
      <div class="w-full max-w-3xl">
        <div class="bg-white shadow-md rounded-lg overflow-hidden">
          <div class="bg-purple-50 p-6 border-b border-purple-100">
            <div class="flex items-center gap-3">
              <i data-lucide="plus-circle" class="h-6 w-6 text-purple-600"></i>
              <h2 class="text-xl font-bold text-gray-800">Add New Address</h2>
            </div>
          </div>
          
          <div class="p-6">
            <form action="/user/address/new/<%= user._id %>" method="POST" class="space-y-6" id="addressForm">
              <!-- Name and Phone -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Full Name*</label>
                  <input 
                    type="text" 
                    id="name"
                    name="name" 
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    placeholder="Enter full name"
                    required
                  >
                </div>
                <div>
                  <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number*</label>
                  <input 
                    type="tel" 
                    id="phone"
                    name="phone" 
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    placeholder="Enter phone number"
                    required
                  >
                </div>
              </div>
              
              <!-- Street Address -->
              <div>
                <label for="streetAddress" class="block text-sm font-medium text-gray-700 mb-1">Street Address*</label>
                <textarea 
                  id="streetAddress"
                  name="streetAddress" 
                  rows="2"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  placeholder="Enter your street address"
                  required
                ></textarea>
              </div>
              
              <!-- City, State, Pin Code -->
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                  <label for="city" class="block text-sm font-medium text-gray-700 mb-1">City*</label>
                  <input 
                    type="text" 
                    id="city"
                    name="city" 
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    placeholder="Enter city"
                    required
                  >
                </div>
                <div>
                  <label for="state" class="block text-sm font-medium text-gray-700 mb-1">State*</label>
                  <input 
                    type="text" 
                    id="state"
                    name="state" 
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    placeholder="Enter state"
                    required
                  >
                </div>
                <div>
                  <label for="pinCode" class="block text-sm font-medium text-gray-700 mb-1">PIN Code*</label>
                  <input 
                    type="text" 
                    id="pinCode"
                    name="pinCode" 
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    placeholder="Enter PIN code"
                    required
                  >
                </div>
              </div>
              
              <!-- Country and Address Type -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label for="country" class="block text-sm font-medium text-gray-700 mb-1">Country*</label>
                  <input 
                    type="text" 
                    id="country"
                    name="country" 
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    placeholder="Enter country"
                    required
                  >
                </div>
                <div>
                  <label for="addressType" class="block text-sm font-medium text-gray-700 mb-1">Address Type*</label>
                  <select 
                    id="addressType"
                    name="addressType" 
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    required
                  >
                    <option value="Home">Home</option>
                    <option value="Office">Office</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
              </div>
              
              <!-- Default Address Checkbox -->
              <div class="flex items-center">
                <input 
                  type="checkbox" 
                  id="isDefault"
                  name="isDefault" 
                  class="h-4 w-4 text-purple-600 focus:ring-purple-500"
                >
                <label for="isDefault" class="ml-2 block text-sm text-gray-700">
                  Set as default address
                </label>
              </div>
              
              <!-- Action Buttons -->
              <div class="flex gap-4 pt-4">
                <button type="submit" class="px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-md">
                  Save Address
                </button>
                <a href="/user/account/<%= user._id %>?tab=address" class="px-6 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-md">
                  Cancel
                </a>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Initialize Lucide Icons -->
  <script>
    lucide.createIcons();
  </script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const addressForm = document.getElementById('addressForm');
    if (addressForm) {
      addressForm.addEventListener("submit", async (e) => {
        e.preventDefault();
  
        // Collect the form data manually
        const data = {
          name: addressForm.elements.name.value,
          phone: addressForm.elements.phone.value,
          streetAddress: addressForm.elements.streetAddress.value,
          city: addressForm.elements.city.value,
          state: addressForm.elements.state.value,
          pinCode: addressForm.elements.pinCode.value,
          country: addressForm.elements.country.value,
          addressType: addressForm.elements.addressType.value,
          // For checkboxes, use .checked to get a boolean value
          isDefault: addressForm.elements.isDefault.checked,
        };
  
        try {
          // Send data as JSON
          const response = await fetch(addressForm.action, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
          });
  
          const result = await response.json();
          if (response.ok) {
            Swal.fire({
              title: "Success!",
              text: "Address saved successfully!",
              icon: "success",
              confirmButtonText: "OK"
            }).then(() => {
              window.location.href = `/user/account/<%= user._id %>?tab=address`;
            });
          } else {
            Swal.fire({
              title: "Error",
              text: result.error || "An error occurred while saving the address.",
              icon: "error",
              confirmButtonText: "OK"
            });
          }
        } catch (error) {
          console.error("Error:", error);
          Swal.fire({
            title: "Error",
            text: "An error occurred while saving the address.",
            icon: "error",
            confirmButtonText: "OK"
          });
        }
      });
    } else {
      console.error("Address form not found!");
    }
  });
  </script>
  

<%- include('../user/partials/foot') %>
<%- include('../user/partials/footer') %>

  